---
title: "Inleiding R Avond Sessie 03"
author: "Longhow Lam"
output: html_notebook
---

```{r, eval=FALSE, include=FALSE}
library(stringr)
library(dplyr)
```



# Plotting data in R

Er zijn veel mogelijkheden om data te plotten in R. In deze sessie zullen we een aantal type plots behandelen:

* de traditionele plots,
* ggplot2,
* en interactieve plots.


## Traditional plots in R
```{r, eval=FALSE, include=FALSE}
x = rnorm(100)
plot(x) 


x1 = rnorm(1000)
plot(x1)
hist(x1)
plot(mydf)

names(mtcars)

plot(mtcars$hp,   mtcars$wt)

points(mtcars$hp, 0.8*mtcars$wt)
pairs(mtcars[,1:5])

hist()

```




## ggplot2 van Hadley Wickham,  

The grammar of graphics, een plot wordt gemaakt door layers op elkaar te leggen, elke laag kan worden beschreven met zigenaamde aesthetics (stijlen)

```{r, eval=FALSE, include=FALSE}
library(ggplot2)


p = ggplot(mtcars, aes(x=hp, y = mpg))
p = p + geom_point(alpha = 0.4)
p

p = p + geom_point(aes(x=hp, y = cyl), col=2)
p

p = p + 
  ggtitle("AUTO PLOTS \n EEN VOORBEELDJE") + 
  theme(plot.title = element_text(lineheight=.8, face="bold"))
p
```

De algemene graphing template in ggplot heeft de volgende vorm

```{r, eval=FALSE, include=FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))
```

Er zijn diverse geom_functies, we zullen er een paar laten zien

```{r}

####  box plots
p = ggplot(mpg, aes(reorder(class, hwy, median), hwy, fill = factor(year))) 
p

p= p +  geom_boxplot()
p

#### histogrammen
ggplot(data=mpg, aes(displ)) + 
  geom_histogram( binwidth = 0.25, col="red", fill="green", alpha = .82) +
  ggtitle("Mijn eerste ggplot2 histogram") + 
  theme(plot.title = element_text(lineheight=.8, face="bold"))

#### lijn grafieken


#### bar plots



```


### facets in ggplot

facet_grid

facet_wrap

### assen en titels

```{r}
ggplot2::scale_x_continuous()
ggplot2::ggtitle()

```


## Interactive grafieken


### ggvis, vergelijkbaar met ggplot

```{r}
library(ggvis)

ggvis(mtcars,~mpg)
ggvis(mtcars,~mpg, ~wt)

# ggvis werkt met %>% chain operator ipv + operator
# handig voor gelaagde plots   (layers)

mtcars %>% ggvis(~factor(cyl), ~mpg) 
mtcars %>% ggvis(~factor(cyl), ~mpg) %>% layer_boxplots()


mtcars %>%
  ggvis(~mpg, ~wt) %>%
  layer_points() %>%
  layer_smooths()


### met wat controls-sturing...

mtcars %>%
  ggvis(~wt, ~mpg) %>%
  layer_smooths(span = input_slider(0.5, 1, value = 1)) %>%
  layer_points(size := input_slider(100, 1000, value = 100))

```


### ploty

#### scatters

#### barcharts

#### 3D surface plots



### leaflet

Leaflets worden gebruikt om interactieve kaartjes te maken

```{r}
library(leaflet)

m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=174.768, lat=-36.852, popup = "The birthplace of R")
m  

# kan geblokt worden door fire walls. ik ga even naar mijn R studio op mijn VPS
```

restaurant data van Iens gescraped

```{r}
Restaurants <- readr::read_csv("data/Restaurants.csv")
Zwolle = Restaurants %>% filter(plaats == "Zwolle")
ptekst = paste(Zwolle$restNamen, '<BR>', Zwolle$aantalreviews)
ptekst = iconv(ptekst, "ISO_8859-2", "UTF-8")

m2 = leaflet(data = Zwolle)
m2 = m2 %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng = ~LONGs, lat = ~LATs, popup = ptekst)
m2  


######## kleurtjes op een kaart
reds = colorNumeric("Reds", domain = NULL)

Zwolle = Zwolle %>% filter(!is.na(aantalreviews), aantalreviews < 80)
ptekst = paste(Zwolle$restNamen, '<BR>', Zwolle$aantalreviews)
ptekst = iconv(ptekst, "ISO_8859-2", "UTF-8")

m2 = leaflet(data = Zwolle)
m2 = m2 %>%
  addTiles() %>%
  addCircleMarkers(lng = ~LONGs, lat = ~LATs, color = ~reds(aantalreviews), fillOpacity = 1, popup = ptekst)
m2

```



### visnetwork

visnetwork kan worden gebruikt voor interactieve netwerk grafieken

```{r}
library(visNetwork)

### twee data sets nodig voor visNetwork
# nodes met id kolom

nodes = data.frame(id = c(1,2,3,4))

# edges met from to kolommen

edges = data.frame(from = c(1,3,4), to  = c(2,2,2))

visNetwork(nodes, edges)


### veel opties nog in de data sets mee tegeven

nodes <- data.frame(
  id = 1:10,
  label = paste("Node", 1:10),                                   # labels
  group = c("GrA", "GrB"),                                       # groups
  value = 1:10,                                                  # size
  shape = c("square", "triangle", "box", "circle", "dot", "star", "ellipse", "database", "text", "diamond"),           # shape
  title = paste0("<p><b>", 1:10,"</b><br>Node !</p>"),           # tooltip
  color = c("darkred", "grey", "orange", "darkblue", "purple"),  # color
  shadow = c(FALSE, TRUE, FALSE, TRUE, TRUE))                    # shadow

edges <- data.frame(from = sample(1:10,8), to = sample(1:10, 8),
  label = paste("Edge", 1:8),                                 # labels
  length = c(100,500),                                        # length
  arrows = c("to", "from", "middle", "middle;to"),            # arrows
  dashes = c(TRUE, FALSE),                                    # dashes
  title = paste("Edge", 1:8),                                 # tooltip
  smooth = c(FALSE, TRUE),                                    # smooth
  shadow = c(FALSE, TRUE, FALSE, TRUE))                       # shadow

visNetwork(nodes, edges)
```


Er zijn diverse opties binnen visnetwork. Bijvoorbeeld highlight nearest

```{r}
nodes <- data.frame(id = 1:15, label = paste("Label", 1:15),
                    group = sample(LETTERS[1:3], 15, replace = TRUE))

edges <- data.frame(from = trunc(runif(15)*(15-1))+1,
                    to = trunc(runif(15)*(15-1))+1)

visNetwork(nodes, edges) %>% visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE)


```

Nog een netwerk voorbeeldje van restaurant bezoekers in Hoorn. Restaurant reviews netwerk in het stadje Hoorn.  Vereist wat data gewroet.... maar dat is vaak zo :-)

Lees eerst link data in.
```{r}
RestaurantLinks <- readRDS("data/RestaurantLinks.RDs")

## bevat vanuit iens.nl per regel een restaurant link.
## als 5 reviewers van A bezocht heeft en ook B dan staat er A  B  5
head(RestaurantLinks)
head(Restaurants)
```

Focus nu alleen op het mooie stadje Hoorn

```{r}
strf = "hoorn"

### Filter hoorn er uit in de links en in de restaurant set
fil1 = RestaurantLinks$IensLink %>% str_detect(strf)
fil2 = RestaurantLinks$IensLink1 %>% str_detect(strf)

Hoorn  = filter(RestaurantLinks, fil1 & fil2  )

### Opschonen restaurant naam, dit moet je doen anders krijg je een error bij publiceren
Hoorn$RestaurantNaam = iconv(Hoorn$RestaurantNaam, "latin1", "ASCII")
Hoorn$RestaurantNaam1 = iconv(Hoorn$RestaurantNaam1, "latin1", "ASCII")

strf2 = "\\bHoorn\\b"
HoornR = Restaurants$plaats  %>% str_detect(strf2)
HoornRes = filter(Restaurants, HoornR)
HoornRes$keuken = iconv(HoornRes$keuken, "latin1", "ASCII")

head(HoornRes)
```

destileer de unieke nodes en edges uit de data en plot de netwerkgrafiek

```{r}
tmp = data.frame(restNamen = unique( c(unique(Hoorn$RestaurantNaam), unique(Hoorn$RestaurantNaam1))))
tmp2 = left_join (tmp, HoornRes, by="restNamen") %>% filter( !is.na(restNamen))

Hoornnodes = data.frame(
  id    = tmp2$restNamen,
  label = tmp2$restNamen,
  title = tmp2$restNamen,
  group = tmp2$keuken)


HoornEdges = data.frame(
  from  = Hoorn$RestaurantNaam,
  to    = Hoorn$RestaurantNaam1, 
  value = Hoorn$COUNT_of_IensLink1)  

#### zet bezoekers van restaurant A naar restaurant A op 1
HoornEdges$value [Hoorn$RestaurantNaam == Hoorn$RestaurantNaam1] = 1

visNetwork(Hoornnodes, HoornEdges) %>% 
  visLegend() %>%
  visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE) %>%
  visInteraction(navigationButtons = TRUE) %>%
  visPhysics( maxVelocity = 25)

```



