---
title: "Inleiding R Avond Sessie 02"
author: "Longhow Lam"
output: html_notebook
---

# The tidyverse

Een verzameling R packages met 'dezelfde' gedachtegoed om data te bewerken / manipuleren 


```{r, eval=FALSE, include=FALSE}
library(tidyverse)
```


## dplyr

Dit package is ontzettend handig om data te bewerken in R. De syntax is elegant en dplyr code kan je in sommige gevallen ook gebruiken voor data die niet in R zit. Bijvoorbeeld data in Spark, kan je met dplyr code bewerken. Er zijn veel sleutel woorden, maar de belangrijkste zijn `select`,  `filter`, `mutate`, `arrange`, `summarize`, `slice` and `rename`.


### kolommen selecteren met select

```{r, eval=FALSE}
## enkele kolommen selecteren

my.cars = select(mtcars, hp, mpg, drat)

my.cars = mtcars %>% 
  select(hp, mpg, drat)

## meerdere kolommen selecteren
test1 = iris %>% 
  select(
    starts_with("Petal")
  )

test2 = mtcars %>% 
  select(
    contains("pg"),
    starts_with("c")
  )

my.cars = mtcars %>% .[2:6]

```

#### kolom maken of wijzigen met mutate
```{r}
my.cars$kolom2  = rnorm(32)
my.cars$kolom3  = my.cars$kolom2 + 9

mutate(mtcars, displ_l = disp / 61.0237)

### distinct rows
distinct( select(mtcars, carb, gear))

distinct(select(mtcars, 10,11))

### pipe / chain operatie
myset = mtcars %>% 
  select(10,11) %>%
  distinct
```


### data sets filteren

```{r, eval=FALSE, include=FALSE}
### data filteren met filter
filter(mtcars, cyl == 8 & gear > 3)

```

###cdata sets aggregeren
aggregeren met de functie group_by en summarise  deze gaan hand in hand samen
```{r}
by_cyl = group_by(mtcars, cyl) 
class(by_cyl)


summarise(by_cyl, Naampje1 = mean(disp), Naampje2 = mean(hp))


out = group_by(mtcars, cyl) %>% 
  summarise( mean(disp), mean(hp))


out = filter(mtcars, mpg > 11) %>%
        group_by(cyl, carb) %>% 
        summarise( N = n(), MeanDisp = mean(disp), SD_HP = sd(hp)) %>%
        
  
df1 = data.frame(x=1:100,y=rnorm(100))
df2 = data.frame(x=51:150, z=rnorm(100))

df3 = left_join(df1, df2, by = "x")
```



### joins
```{r, eval=FALSE, include=FALSE}
df1 = data.frame(col1 = c(1,2,3,4,5), tt = rnorm(5))
df2 = data.frame(col2 = c(3,4,5,6,7), xx = rnorm(5))

inner_join(df1, df2, by = c("col1" = "col2"))
left_join(df1, df2, by = c("col1" = "col2"))
right_join(df1, df2, by = c("col1" = "col2"))

anti_join(df1, df2, by = c("col1" = "col2"))
full_join(df1, df2, by = c("col1" = "col2"))
```


### wide data 

Soms heb je data die in de verkeerde vorm zit. melt / reshape



## stringr

Character data in R kan je bewerken/manipuleren met het `stringr` package. Voordat we daar verder op in gaan is het handig om te weten wat reguliere expressies zijn.

### Reguliere expressies

Dit is een soort 'mini' taaltje om character patronen te formuleren

```{r}
test = c("dit is een 1628EP postcode test", "foutje?:  0234XD", "dit is er nog een 1628 EP", "en nog een foute 126EP", "nog een 1234    XX", "1234eZ en nog 4567PK")
test

# Hoe haal je de goede postcodes er uit?


# zie ook help bij grep 
```

### functies uit het package stringr


str_locate
str_locate_all

str_sub
str_length

str_match

str_detect
str_trim

str_replace
str_repalce_all
str_tolower

```{r}

titanic::titanic_train
## maak extra kolom aan in titanic die namen zoekt
mutate
```

## forcats


## tidyr


## Dates in R

Voor datums in R zijn de packages `anydate` en `lubridate` heel handig.

```{r}



```



