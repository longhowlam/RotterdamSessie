---
title: 'Inleiding R: Avond Sessie 01'
author: "Longhow Lam"
output: html_notebook
#output:
#  prettydoc::html_pretty:
#    toc: true
#    number_sections: true
#    highlight: github
#    theme: cayman
---

# Inleding

## De RStudio omgeving

Begin met powerpoint slides over R en R Studio

* Rstudio
* Environment tab (Object browser)
* packages

## R Projecten

Organiseer je R werk in projecten. Een project kan bestaan uit verschillende scripts, data en output, deze wil je handig in 1 folder hebben. In RStudio kan je heel handig met verschillende R projecten werken. Via de GUI kun je nieuwe projecten aanmaken en beheren.  


## Scripts 

Scripts, zijn gewone tekst files (*.R) met R code. In RStudio kan je meerdere scripts openen en bewerken. Scripts die bij elkaar horen kan je in een R Project zetten.

* Handy shortcuts
* Find in files.... 
* Code folding


## R Notebooks

R notebooks bevatten meer dan alleen R code, het is een 'compleet' document code, output en een beschrijvende verhaallijn tot een document te weven. Dit gebeurt met markdown, een soort light weight markup language. Deze R cursus werkt met notebooks. Een notebook bevat (R) code chunks die je kan runnen.

Een R notebook kan je 'breien' tot een html/pdf/word document of je kan de

## Een paar simpele expressie

Hieronder een paar simpele expressies in R om te beginnen


```{r, eval=FALSE}

1 + 1
print("hello world")

test = 9
test
```

In R zijn namen van objecten *case-sensitive!*

```{r, eval=FALSE, include=FALSE}
x = 8
X = 8

getwd()
ls()


786 / (87 +87)

pi / asin(1)

exp(1) 

ls()
```


Help in R is <F1> op een functie.  F1 op de functie: cut


# Data types

Alle data in R is van een bepaalde type, we zullen de verschillende types hieronder behandelen. met de functie `typeof` kan je het type altijd opvragen van een object in R.

## integer

Integers in R zijn gehele getallen.

```{r, eval=FALSE}
x = 1
y = 2

is.integer(x)

x = as.integer(1)
z = x + 9.78

is.integer(z)

y = 34L
is.integer(y)

```

## character

In R kan je met het `character` data type teksten opslaan. bewerkingen en manipulaties van characters in sessie 2.

```{r, eval=FALSE}

x1 = "Longhow Lam"
x2 = "1628 AA Hoorn"

is.character(x1)

nchar(x2)

x3 = paste(x1, x2)
x3 = paste(x1, x2, sep="")
```


## factor

factors in R zijn bedoeld om categorische variable te representeren. Denk aan geslacht, of opleiding. Verwar factor niet met character.

```{r, eval=FALSE}
x3 = c("M", "F", "M")

is.character(x3)
typeof(x3)

y3 = as.factor(x3)
x3
y3

# dit is wel apart
typeof(y3)
is.character(y3)
is.factor(y3)
is.integer(y3)


levels(y3)
levels(x3)

# Dus let op het verschil tussen factors en characters!!!!

```

## double

doubles ijn niet gehele getallen

```{r, eval=FALSE}
x4 = 4
x5 = 5.6 / 8
x6 = pi/2

is.double(x4)
```


## logical

In R gebruik je logicals om dingen te testen

```{r, eval=FALSE}
x7 = TRUE
x8 = FALSE

typeof(x7)

x9 = x6 < 8

is.logical(x9)

x1 = as.integer(1)
x2 = 1

x1
x2

## let op in R kunnen double aan integers gelijk zijn
is.integer(x2)
is.integer(x1)

x1 == x2

```


```{r, eval=FALSE}
### logische operatoren

TRUE & FALSE    # AND
!TRUE           # NOT
!FALSE
TRUE | FALSE    # OR

# Je kan rekenen met logicals
TRUE + TRUE
FALSE + FALSE + TRUE


### What the F...

0.1 + 0.2 == 0.3


1 + 2 == 3
x = 0.3

sprintf("%.16f", x)
sprintf("%.24f", x)

```


## oneindig

```{r, eval=FALSE}
x1 = 9/0
x2 = -x1
x1
is.infinite(x2)
```

## missing value


```{r, eval=FALSE, include=FALSE}
x3 = NA

# gebruik is.na om te checken of iets NA is
is.na(x3)

x4 = c(1, 2, 3, 4, NA, 5, 7)

# hoeveel elementen zijn NA en niet NA
sum(is.na(x4))
sum(!is.na(x4))

x4 < 4

is.na(x4)

```



## waar zijn mijn objecten

```{r, eval=FALSE}
ls()

objects()
```

wat is een search path...

```{r, eval=FALSE}


Pietje  # wordt niet gevonden

### Objecten worden volgens een zoekpad gezocht
search()


objects(pos = 5)

## deze worden wel gevonden

OrchardSprays
iris

iris = 9

iris

########  weghalen van objecten
x = 5
rm(x)

## standaard alleen objecten weg te halen uit de work directoy, je 'huidige sessie'

iris
rm(iris)

datasets::iris


rm(iris)


########   bewaren van objecten en work directory
x = 45

# bewaar een specifiek object
saveRDS(x, file = "ObjectX.Rds")

# bewaar een heel image,  dit wordt standaard gevraagd als je Rstudio afsluit
save.image()


```


# data structures

Dat in R kan bewaard worden in verschillende data structuren, we zullen hier de structuren behandelen


## vectors

Vectoren worden gebruikt om een 'rijtje' elementen op te slaan. Je kan een vector van doubles hebben, characters etc...

```{r, eval=FALSE, include=FALSE}
x0 = 1
x0 = c( 1, 2, 3, 4, 5)
x1 = 1:1000
x1 <- 187:278

x2 = seq(1,50,length=100)
length(x2)
class(x2)

x2a = seq(1,500, by = 20)

x3 = c( x0, rnorm(100))

x4 = sample( letters, rep = TRUE, size = 100)

class(x4)

y = 3 * x3 + 8

## en wat is dit???
y = x4 + 8


x4 = rep(1:6, 7)
x4 = rep(x4,8)

x5 = rep(1:10, each = 3)
```


### subscripting of vectors

Hoe benader je elementen in een vector? Dat kan met subscripts

```{r, eval=FALSE, include=FALSE}
x3[9]
x3[  4:10  ]

x3[  -(1:10)]

x3[  8:17  ] = 0


## simpele functies op vectoren 
y = rnorm(1000)
mean(y)
var(y ) 

sd(y)
summary(y)

class(y)
class(x3)

tmp <- y > 5
tmp
class(tmp)
sum(tmp)
sum(x3 < 0)

```


##  matrices

Een matrix is een verzameling van vectoren die even lang zijn.

```{r, eval=FALSE, include=FALSE}
m1 = rnorm(100)

m2 = matrix(m1, byrow = FALSE, ncol=10)
m2
dim(m2)
class(m2)

det(m2)

t(m2)
solve(m2)

# inverse van een matrix
m2 %*% solve(m2)
m2 * solve(m2)

round(m2 %*% solve(m2))

## matrix subscripts 

m2[1,5]

m2[  4:10,    3:5]

m2[5,]

m2[ ,5]

```


## multidimensional arrays

arrays zijn 3 dimensionale (of hoger) matrices

```{r, eval=FALSE, include=FALSE}
m = array(1:1000, dim = c(10,10,10))

m[1,5,7]

m[1,4,  ]

m[,4,]
class(m)

```


## data frames

Een data frame kan je zien als een matrix, maar in tegenstelling tot een matrix, kunnen kolommen van een data frame van een andere type zijn.

```{r, eval=FALSE, include=FALSE}
x1 = 1:100
x2 = rnorm(100)
x3 = rnorm(100)
x4 = sample(c("M","F"), size = 100, replace = TRUE)

mydf = data.frame(kolomnaampj1 = x1, income = x2, age=x3, type = x4)


head(mydf,10)
names(mydf)

dim(mydf)
class(mydf)

levels(mydf$type)

### pas op met characters die worden standaard in data frames naar factors omgezet
x4
class(x4)
class(mydf$type)


mydf = data.frame(kolomnaampj1 = x1, income = x2, age=x3, type = x4, stringsAsFactors = FALSE)
mydf
class(mydf$type)

## Dit is ook in de Environment viewer te zien

## rownames colnames
tmp = mtcars
row.names(tmp)
colnames(tmp)

tmp$NewCol = tmp$mpg / tmp$wt

########  "ECHTE" data maak je natuurlijk niet vaak aan zoals hierboven....

## Importeren van data sets naar data frames
VA_RANDOM_PERSONS <- read.csv("D:/Jibes/Projecten/EFR_RCOURSE/DataSets/VA_RANDOM_PERSONS.csv", stringsAsFactors=FALSE)

```


## tibles

tibles zijn een soort moderne versie van data.frames, afkomstig van Hadley Wickham en er zijn een aantal voordelen om tibbles te gebruiiken...  zie ook zijn boek en de website [tibles.](http://tibble.tidyverse.org/)

```{r}


```


## lists

lijsten zijn soms het resultaat van een functie die allerlei dingen teruggeeft in een lijst

```{r, eval=FALSE, include=FALSE}
l1 <- list( a = 1, b = 1:100, c = m2, d = mydf)

l2 <- list (zz = rnorm(100), pp = l1)

l2[[2]]


l2[[2]][[4]][[3]][5:9]

l1$age[5:9]


l1[[3]]


l1$c[1,4]
l1[[4]]$x2[3]

```



##  functions in R

```{r, eval=FALSE, include=FALSE}
# We kunnen zelf ook functiues schrijven 
x = 1:10 
y = 1:10

f1 <- x + y

###########################

f1 <- function(x, y){
  tmp = 2*y
  tmp2 = 3*x
  if (x < 0){
    return(1)
  }
  else
  {
    return(tmp + tmp2)
  }
}

f1

f1(9,2)


############################
f2 = function(x)
{
  out = numeric(length(x))
  
  for(i in 2:length(x)){
    out[i] = (x[i-1] + x[i])/2
  }
  return(out)
}

f2( 1:100)


#   The %>%  pipe (or chain) operator by Hadley Wickham...

tan(cos(sin(0.33)))

0.33 %>% sin %>% cos %>% tan

0.33 %>% 
  sin %>%
  cos %>% 
  tan
```





# importeren van data 

## vanuit tekst files

readr package

## vanuit SQL server

```{r, eval=FALSE}
library(RODBC)
# nodig dat MSSQLSERVER service gestart moet worden

# specificeer connectie
cn <- odbcDriverConnect(connection="Driver={SQL Server Native Client 11.0};server=localhost;database=Testing;trusted_connection=yes;")

sqlTables(cn, schema ="dbo")

RandomPersons = sample_n(VA_RANDOM_PERSONS, 75000)

# haal data uit SQLSERVER
sqlFetch(cn,"cars")

# schrijf weg
sqlSave(cn, RandomPersons)

```



